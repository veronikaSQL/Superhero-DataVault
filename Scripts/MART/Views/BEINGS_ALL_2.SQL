CREATE OR REPLACE VIEW MART.BEINGS_ALL
AS
SELECT
SPLIT_PART(URL,':',1) AS DATA_SOURCE
,URL
,NAME
,ALIASES
,RACE
,FULL_NAME
,'' AS POWERS
,SPLIT_PART(HEIGHT, ' : ', 1) as HEIGHT_FT
,try_to_number(SPLIT_PART(SPLIT_PART(iff(HEIGHT like '%-%', NULL,HEIGHT ), ' : ', 1), '''', 1))*12 + try_to_number (SPLIT_PART(SPLIT_PART(iff(HEIGHT like '%-%', NULL,HEIGHT ), ' : ', 1), '''', 2)) as HEIGHT_IN 
,try_to_number(TRIM(REPLACE(SPLIT_PART(HEIGHT, ' : ', 2),'cm',''))) as HEIGHT_CM
,try_to_number(TRIM(REPLACE(SPLIT_PART(WEIGHT, ' : ', 1),'lb',''))) as WEIGHT_LB
,try_to_number(TRIM(REPLACE(SPLIT_PART(WEIGHT, ' : ', 2),'kg',''))) as WEIGHT_KG
, EFFECTIVE_FROM_DT 
, EFFECTIVE_TO_DT
, IS_CURRENT  
FROM DATA_VAULT.SAT_BEING_SUPERHERODB
UNION ALL
SELECT 
SPLIT_PART(URL,':',1) AS DATA_SOURCE
,URL
,NAME
,ARRAY_TO_STRING(JSON_RAW:aliases::array,',') as ALIASES
,ARRAY_TO_STRING(JSON_RAW:species::array,',') as SPECIES
,ARRAY_TO_STRING(JSON_RAW:secretIdentities::array,',') AS IDENTITIES 
,ARRAY_TO_STRING(JSON_RAW:powers::array,',') AS POWERS
,NULL
,NULL
,NULL
,NULL
,NULL
, EFFECTIVE_FROM_DT 
, EFFECTIVE_TO_DT
, IS_CURRENT 
FROM DATA_VAULT.SAT_BEING_MARVEL_SEARCH 
;


 
CREATE OR REPLACE VIEW MART.BEINGS_ALL
AS
SELECT
SPLIT_PART(URL,':',1) AS DATA_SOURCE
,URL
,NAME
,ALIASES
,RACE
,FULL_NAME
,IFF((len(GENDER)=0 or IFNULL(GENDER,'-') ILIKE  '-'),'UNKNOWN', GENDER) AS GENDER
,'' AS POWERS
,SPLIT_PART(HEIGHT, ' : ', 1) as HEIGHT_FT
,try_to_number(SPLIT_PART(SPLIT_PART(iff(HEIGHT like '%-%', NULL,HEIGHT ), ' : ', 1), '''', 1))*12 + try_to_number (SPLIT_PART(SPLIT_PART(iff(HEIGHT like '%-%', NULL,HEIGHT ), ' : ', 1), '''', 2)) as HEIGHT_IN 
,try_to_number(TRIM(REPLACE(SPLIT_PART(HEIGHT, ' : ', 2),'cm',''))) as HEIGHT_CM
,try_to_number(TRIM(REPLACE(SPLIT_PART(WEIGHT, ' : ', 1),'lb',''))) as WEIGHT_LB
,try_to_number(TRIM(REPLACE(SPLIT_PART(WEIGHT, ' : ', 2),'kg',''))) as WEIGHT_KG
, EFFECTIVE_FROM_DT 
, EFFECTIVE_TO_DT
, IS_CURRENT  
FROM DATA_VAULT.SAT_BEING_SUPERHERODB
UNION ALL
SELECT 
SPLIT_PART(URL,':',1) AS DATA_SOURCE
,URL
,NAME
,ARRAY_TO_STRING(JSON_RAW:aliases::array,',') as ALIASES
,ARRAY_TO_STRING(JSON_RAW:species::array,',') as SPECIES
,ARRAY_TO_STRING(JSON_RAW:secretIdentities::array,',') AS IDENTITIES 
,'UNKNOWN' AS GENDER
,ARRAY_TO_STRING(JSON_RAW:powers::array,',') AS POWERS
,NULL
,NULL
,NULL
,NULL
,NULL
, EFFECTIVE_FROM_DT 
, EFFECTIVE_TO_DT
, IS_CURRENT 
FROM DATA_VAULT.SAT_BEING_MARVEL_SEARCH 
UNION ALL
SELECT 
SPLIT_PART(URL,':',1) AS DATA_SOURCE
,URL
,NAME
, ARRAY_TO_STRING(parse_json(ALIASES),',')  AS ALIASES
,TYPE_RACE AS RACE
,FULL_NAME
,IFF((len(GENDER)=0 or IFNULL(GENDER,'-') ILIKE  '-'),'UNKNOWN', GENDER) AS GENDER
,SUPERPOWERS AS POWERS
,replace(SPLIT_PART(HEIGHT, ' • ', 1),'"','') as HEIGHT_FT
,try_to_number(SPLIT_PART(SPLIT_PART(iff(HEIGHT_FT like '%-%', NULL,HEIGHT_FT ), ' • ', 1), '''', 1))*12 
     + try_to_number (SPLIT_PART(SPLIT_PART(iff(HEIGHT_FT like '%-%', NULL,HEIGHT_FT ), ' • ', 1), '''', 2)) as HEIGHT_IN 
,try_to_number(TRIM(REPLACE(SPLIT_PART(HEIGHT, ' • ', 2),'cm',''))) as HEIGHT_CM
,try_to_number(regexp_replace(SPLIT_PART(WEIGHT, ' • ', 1),',|lb',''))as WEIGHT_LB
,iff(WEIGHT ilike '%tons%',try_to_number(regexp_replace(SPLIT_PART(WEIGHT, ' • ', 2),',|tons',''))*1000, try_to_number(regexp_replace(SPLIT_PART(WEIGHT, ' • ', 2),',|kg',''))) as WEIGHT_KG  
,EFFECTIVE_FROM_DT
,EFFECTIVE_TO_DT
,IS_CURRENT
FROM DATA_VAULT.SAT_BEING_KAGGLE_NLP;
