INSERT INTO  DATA_VAULT.SAT_BEING_KAGGLE_NLP_RAW
WITH READ_FROM_RAW AS 
(
    SELECT DISTINCT
     IMG as SOURCE_URL 
    ,'KAGGLE_NLP:'||SOURCE_URL AS URL
    , MD5(URL) AS HUB_BEING_KEY    
    , NAME
    , REAL_NAME
    , FULL_NAME
    , OVERALL_SCORE
    , HISTORY_TEXT
    , POWERS_TEXT
    , INTELLIGENCE_SCORE
    , STRENGTH_SCORE
    , SPEED_SCORE
    , DURABILITY_SCORE
    , POWER_SCORE
    , COMBAT_SCORE
    , SUPERPOWERS
    , ALTER_EGOS
    , ALIASES
    , PLACE_OF_BIRTH
    , FIRST_APPEARANCE
    , CREATOR
    , ALIGNMENT
    , OCCUPATION
    , BASE
    , TEAMS
    , RELATIVES
    , GENDER
    , TYPE_RACE
    , HEIGHT
    , WEIGHT
    , EYE_COLOR
    , HAIR_COLOR
    , SKIN_COLOR
    , IMG
    , HAS_ELECTROKINESIS
    , HAS_ENERGY_CONSTRUCTS
    , HAS_MIND_CONTROL_RESISTANCE
    , HAS_MATTER_MANIPULATION
    , HAS_TELEPATHY_RESISTANCE
    , HAS_MIND_CONTROL
    , HAS_ENHANCED_HEARING
    , HAS_DIMENSIONAL_TRAVEL
    , HAS_ELEMENT_CONTROL
    , HAS_SIZE_CHANGING
    , HAS_FIRE_RESISTANCE
    , HAS_FIRE_CONTROL
    , HAS_DEXTERITY
    , HAS_REALITY_WARPING
    , HAS_ILLUSIONS
    , HAS_ENERGY_BEAMS
    , HAS_PEAK_HUMAN_CONDITION
    , HAS_SHAPESHIFTING
    , HAS_HEAT_RESISTANCE
    , HAS_JUMP
    , HAS_SELF_SUSTENANCE
    , HAS_ENERGY_ABSORPTION
    , HAS_COLD_RESISTANCE
    , HAS_MAGIC
    , HAS_TELEKINESIS
    , HAS_TOXIN_AND_DISEASE_RESISTANCE
    , HAS_TELEPATHY
    , HAS_REGENERATION
    , HAS_IMMORTALITY
    , HAS_TELEPORTATION
    , HAS_FORCE_FIELDS
    , HAS_ENERGY_MANIPULATION
    , HAS_ENDURANCE
    , HAS_LONGEVITY
    , HAS_WEAPON_BASED_POWERS
    , HAS_ENERGY_BLASTS
    , HAS_ENHANCED_SENSES
    , HAS_INVULNERABILITY
    , HAS_STEALTH
    , HAS_MARKSMANSHIP
    , HAS_FLIGHT
    , HAS_ACCELERATED_HEALING
    , HAS_WEAPONS_MASTER
    , HAS_INTELLIGENCE
    , HAS_REFLEXES
    , HAS_SUPER_SPEED
    , HAS_DURABILITY
    , HAS_STAMINA
    , HAS_AGILITY
    , HAS_SUPER_STRENGTH
    , MD5(ARRAY_TO_STRING(ARRAY_CONSTRUCT(
     UPPER(TRIM(IFNULL(NAME,'')))
    , UPPER(TRIM(IFNULL(REAL_NAME,'')))
    , UPPER(TRIM(IFNULL( FULL_NAME,'')))
    , UPPER(TRIM(IFNULL( OVERALL_SCORE,'')))
    , UPPER(TRIM(IFNULL( HISTORY_TEXT,'')))
    , UPPER(TRIM(IFNULL( POWERS_TEXT,'')))
    , UPPER(TRIM(IFNULL( INTELLIGENCE_SCORE,'')))
    , UPPER(TRIM(IFNULL( STRENGTH_SCORE,'')))
    , UPPER(TRIM(IFNULL( SPEED_SCORE,'')))
    , UPPER(TRIM(IFNULL( DURABILITY_SCORE,'')))
    , UPPER(TRIM(IFNULL( POWER_SCORE,'')))
    , UPPER(TRIM(IFNULL( COMBAT_SCORE,'')))
    , UPPER(TRIM(IFNULL( SUPERPOWERS,'')))
    , UPPER(TRIM(IFNULL( ALTER_EGOS,'')))
    , UPPER(TRIM(IFNULL( ALIASES,'')))
    , UPPER(TRIM(IFNULL( PLACE_OF_BIRTH,'')))
    , UPPER(TRIM(IFNULL( FIRST_APPEARANCE,'')))
    , UPPER(TRIM(IFNULL( CREATOR,'')))
    , UPPER(TRIM(IFNULL( ALIGNMENT,'')))
    , UPPER(TRIM(IFNULL( OCCUPATION,'')))
    , UPPER(TRIM(IFNULL( BASE,'')))
    , UPPER(TRIM(IFNULL( TEAMS,'')))
    , UPPER(TRIM(IFNULL( RELATIVES,'')))
    , UPPER(TRIM(IFNULL( GENDER,'')))
    , UPPER(TRIM(IFNULL( TYPE_RACE,'')))
    , UPPER(TRIM(IFNULL( HEIGHT,'')))
    , UPPER(TRIM(IFNULL( WEIGHT,'')))
    , UPPER(TRIM(IFNULL( EYE_COLOR,'')))
    , UPPER(TRIM(IFNULL( HAIR_COLOR,'')))
    , UPPER(TRIM(IFNULL( SKIN_COLOR,'')))
    , UPPER(TRIM(IFNULL( HAS_ELECTROKINESIS,'')))
    , UPPER(TRIM(IFNULL( HAS_ENERGY_CONSTRUCTS,'')))
    , UPPER(TRIM(IFNULL( HAS_MIND_CONTROL_RESISTANCE,'')))
    , UPPER(TRIM(IFNULL( HAS_MATTER_MANIPULATION,'')))
    , UPPER(TRIM(IFNULL( HAS_TELEPATHY_RESISTANCE,'')))
    , UPPER(TRIM(IFNULL( HAS_MIND_CONTROL,'')))
    , UPPER(TRIM(IFNULL( HAS_ENHANCED_HEARING,'')))
    , UPPER(TRIM(IFNULL( HAS_DIMENSIONAL_TRAVEL,'')))
    , UPPER(TRIM(IFNULL( HAS_ELEMENT_CONTROL,'')))
    , UPPER(TRIM(IFNULL( HAS_SIZE_CHANGING,'')))
    , UPPER(TRIM(IFNULL( HAS_FIRE_RESISTANCE,'')))
    , UPPER(TRIM(IFNULL( HAS_FIRE_CONTROL,'')))
    , UPPER(TRIM(IFNULL( HAS_DEXTERITY,'')))
    , UPPER(TRIM(IFNULL( HAS_REALITY_WARPING,'')))
    , UPPER(TRIM(IFNULL( HAS_ILLUSIONS,'')))
    , UPPER(TRIM(IFNULL( HAS_ENERGY_BEAMS,'')))
    , UPPER(TRIM(IFNULL( HAS_PEAK_HUMAN_CONDITION,'')))
    , UPPER(TRIM(IFNULL( HAS_SHAPESHIFTING,'')))
    , UPPER(TRIM(IFNULL( HAS_HEAT_RESISTANCE,'')))
    , UPPER(TRIM(IFNULL( HAS_JUMP,'')))
    , UPPER(TRIM(IFNULL( HAS_SELF_SUSTENANCE,'')))
    , UPPER(TRIM(IFNULL( HAS_ENERGY_ABSORPTION,'')))
    , UPPER(TRIM(IFNULL( HAS_COLD_RESISTANCE,'')))
    , UPPER(TRIM(IFNULL( HAS_MAGIC,'')))
    , UPPER(TRIM(IFNULL( HAS_TELEKINESIS,'')))
    , UPPER(TRIM(IFNULL( HAS_TOXIN_AND_DISEASE_RESISTANCE,'')))
    , UPPER(TRIM(IFNULL( HAS_TELEPATHY,'')))
    , UPPER(TRIM(IFNULL( HAS_REGENERATION,'')))
    , UPPER(TRIM(IFNULL( HAS_IMMORTALITY,'')))
    , UPPER(TRIM(IFNULL( HAS_TELEPORTATION,'')))
    , UPPER(TRIM(IFNULL( HAS_FORCE_FIELDS,'')))
    , UPPER(TRIM(IFNULL( HAS_ENERGY_MANIPULATION,'')))
    , UPPER(TRIM(IFNULL( HAS_ENDURANCE,'')))
    , UPPER(TRIM(IFNULL( HAS_LONGEVITY,'')))
    , UPPER(TRIM(IFNULL( HAS_WEAPON_BASED_POWERS,'')))
    , UPPER(TRIM(IFNULL( HAS_ENERGY_BLASTS,'')))
    , UPPER(TRIM(IFNULL( HAS_ENHANCED_SENSES,'')))
    , UPPER(TRIM(IFNULL( HAS_INVULNERABILITY,'')))
    , UPPER(TRIM(IFNULL( HAS_STEALTH,'')))
    , UPPER(TRIM(IFNULL( HAS_MARKSMANSHIP,'')))
    , UPPER(TRIM(IFNULL( HAS_FLIGHT,'')))
    , UPPER(TRIM(IFNULL( HAS_ACCELERATED_HEALING,'')))
    , UPPER(TRIM(IFNULL( HAS_WEAPONS_MASTER,'')))
    , UPPER(TRIM(IFNULL( HAS_INTELLIGENCE,'')))
    , UPPER(TRIM(IFNULL( HAS_REFLEXES,'')))
    , UPPER(TRIM(IFNULL( HAS_SUPER_SPEED,'')))
    , UPPER(TRIM(IFNULL( HAS_DURABILITY,'')))
    , UPPER(TRIM(IFNULL( HAS_STAMINA,'')))
    , UPPER(TRIM(IFNULL( HAS_AGILITY,'')))
    , UPPER(TRIM(IFNULL( HAS_SUPER_STRENGTH,'')))
        ),'~')) AS RECORD_HASH
from "SUPERHERO"."DEMO".SUPERHEROS_KAGGLE_HEROES_NLP where img is not null
  )
  
  SELECT
    MD5(SRC.HUB_BEING_KEY || current_timestamp()::timestamp_tz )AS SAT_BEING_KAGGLE_NLP_KEY
    , SRC.HUB_BEING_KEY
    , SRC.URL
    , SRC.SOURCE_URL
    , SRC.NAME
    , SRC.REAL_NAME
    , SRC.FULL_NAME
    , SRC.OVERALL_SCORE
    , SRC.HISTORY_TEXT
    , SRC.POWERS_TEXT
    , SRC.INTELLIGENCE_SCORE
    , SRC.STRENGTH_SCORE
    , SRC.SPEED_SCORE
    , SRC.DURABILITY_SCORE
    , SRC.POWER_SCORE
    , SRC.COMBAT_SCORE
    , SRC.SUPERPOWERS
    , SRC.ALTER_EGOS
    , SRC.ALIASES
    , SRC.PLACE_OF_BIRTH
    , SRC.FIRST_APPEARANCE
    , SRC.CREATOR
    , SRC.ALIGNMENT
    , SRC.OCCUPATION
    , SRC.BASE
    , SRC.TEAMS
    , SRC.RELATIVES
    , SRC.GENDER
    , SRC.TYPE_RACE
    , SRC.HEIGHT
    , SRC.WEIGHT
    , SRC.EYE_COLOR
    , SRC.HAIR_COLOR
    , SRC.SKIN_COLOR
    , SRC.IMG
    , SRC.HAS_ELECTROKINESIS
    , SRC.HAS_ENERGY_CONSTRUCTS
    , SRC.HAS_MIND_CONTROL_RESISTANCE
    , SRC.HAS_MATTER_MANIPULATION
    , SRC.HAS_TELEPATHY_RESISTANCE
    , SRC.HAS_MIND_CONTROL
    , SRC.HAS_ENHANCED_HEARING
    , SRC.HAS_DIMENSIONAL_TRAVEL
    , SRC.HAS_ELEMENT_CONTROL
    , SRC.HAS_SIZE_CHANGING
    , SRC.HAS_FIRE_RESISTANCE
    , SRC.HAS_FIRE_CONTROL
    , SRC.HAS_DEXTERITY
    , SRC.HAS_REALITY_WARPING
    , SRC.HAS_ILLUSIONS
    , SRC.HAS_ENERGY_BEAMS
    , SRC.HAS_PEAK_HUMAN_CONDITION
    , SRC.HAS_SHAPESHIFTING
    , SRC.HAS_HEAT_RESISTANCE
    , SRC.HAS_JUMP
    , SRC.HAS_SELF_SUSTENANCE
    , SRC.HAS_ENERGY_ABSORPTION
    , SRC.HAS_COLD_RESISTANCE
    , SRC.HAS_MAGIC
    , SRC.HAS_TELEKINESIS
    , SRC.HAS_TOXIN_AND_DISEASE_RESISTANCE
    , SRC.HAS_TELEPATHY
    , SRC.HAS_REGENERATION
    , SRC.HAS_IMMORTALITY
    , SRC.HAS_TELEPORTATION
    , SRC.HAS_FORCE_FIELDS
    , SRC.HAS_ENERGY_MANIPULATION
    , SRC.HAS_ENDURANCE
    , SRC.HAS_LONGEVITY
    , SRC.HAS_WEAPON_BASED_POWERS
    , SRC.HAS_ENERGY_BLASTS
    , SRC.HAS_ENHANCED_SENSES
    , SRC.HAS_INVULNERABILITY
    , SRC.HAS_STEALTH
    , SRC.HAS_MARKSMANSHIP
    , SRC.HAS_FLIGHT
    , SRC.HAS_ACCELERATED_HEALING
    , SRC.HAS_WEAPONS_MASTER
    , SRC.HAS_INTELLIGENCE
    , SRC.HAS_REFLEXES
    , SRC.HAS_SUPER_SPEED
    , SRC.HAS_DURABILITY
    , SRC.HAS_STAMINA
    , SRC.HAS_AGILITY
    , SRC.HAS_SUPER_STRENGTH
    , SRC.RECORD_HASH
    , current_timestamp()::timestamp_tz as LOAD_TIME
from READ_FROM_RAW src
 LEFT JOIN DATA_VAULT.SAT_BEING_KAGGLE_NLP_RAW TGT
    ON SRC.HUB_BEING_KEY = TGT.HUB_BEING_KEY
    AND SRC.RECORD_HASH = TGT.RECORD_HASH
    WHERE TGT.HUB_BEING_KEY IS NULL;
;
