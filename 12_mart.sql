use database mart;
use warehouse ad_hoc_wh;
use schema superhero;
use role sysadmin;

-- create mart view joining "BII" and non "BII" data. See column definition in snowsight

 create or replace view super_beings
 (BEING_ID comment 'Super Being Business Key',
	HUB_BEING_KEY comment 'Hashed value of the super being business key',
	NAME comment 'Super Being Name',
	PUBLISHER,
	ALIGNMENT,
	AGILITY,
	ACCELERATED_HEALING,
	LANTERN_POWER_RING,
	DIMENSIONAL_AWARENESS,
	COLD_RESISTANCE,
	DURABILITY,
	STEALTH,
	ENERGY_ABSORPTION,
	FLIGHT,
	DANGER_SENSE,
	UNDERWATER_BREATHING,
	MARKSMANSHIP,
	WEAPONS_MASTER,
	POWER_AUGMENTATION,
	ANIMAL_ATTRIBUTES,
	LONGEVITY,
	INTELLIGENCE,
	SUPER_STRENGTH,
	CRYOKINESIS,
	TELEPATHY,
	ENERGY_ARMOR,
	ENERGY_BLASTS,
	DUPLICATION,
	SIZE_CHANGING,
	DENSITY_CONTROL,
	STAMINA,
	ASTRAL_TRAVEL,
	AUDIO_CONTROL,
	DEXTERITY,
	OMNITRIX,
	SUPER_SPEED,
	POSSESSION,
	ANIMAL_ORIENTED_POWERS,
	WEAPON_BASED_POWERS,
	ELECTROKINESIS,
	DARKFORCE_MANIPULATION,
	DEATH_TOUCH,
	TELEPORTATION,
	ENHANCED_SENSES,
	TELEKINESIS,
	ENERGY_BEAMS,
	MAGIC,
	HYPERKINESIS,
	JUMP,
	CLAIRVOYANCE,
	DIMENSIONAL_TRAVEL,
	POWER_SENSE,
	SHAPESHIFTING,
	PEAK_HUMAN_CONDITION,
	IMMORTALITY,
	CAMOUFLAGE,
	ELEMENT_CONTROL,
	PHASING,
	ASTRAL_PROJECTION,
	ELECTRICAL_TRANSPORT,
	FIRE_CONTROL,
	PROJECTION,
	SUMMONING,
	ENHANCED_MEMORY,
	REFLEXES,
	INVULNERABILITY,
	ENERGY_CONSTRUCTS,
	FORCE_FIELDS,
	SELF_SUSTENANCE,
	ANTI_GRAVITY,
	EMPATHY,
	POWER_NULLIFIER,
	RADIATION_CONTROL,
	PSIONIC_POWERS,
	ELASTICITY,
	SUBSTANCE_SECRETION,
	ELEMENTAL_TRANSMOGRIFICATION,
	TECHNOPATH_CYBERPATH,
	PHOTOGRAPHIC_REFLEXES,
	SEISMIC_POWER,
	ANIMATION,
	PRECOGNITION,
	MIND_CONTROL,
	FIRE_RESISTANCE,
	POWER_ABSORPTION,
	ENHANCED_HEARING,
	NOVA_FORCE,
	INSANITY,
	HYPNOKINESIS,
	ANIMAL_CONTROL,
	NATURAL_ARMOR,
	INTANGIBILITY,
	ENHANCED_SIGHT,
	MOLECULAR_MANIPULATION,
	HEAT_GENERATION,
	ADAPTATION,
	GLIDING,
	POWER_SUIT,
	MIND_BLAST,
	PROBABILITY_MANIPULATION,
	GRAVITY_CONTROL,
	REGENERATION,
	LIGHT_CONTROL,
	ECHOLOCATION,
	LEVITATION,
	TOXIN_AND_DISEASE_CONTROL,
	BANISH,
	ENERGY_MANIPULATION,
	HEAT_RESISTANCE,
	NATURAL_WEAPONS,
	TIME_TRAVEL,
	ENHANCED_SMELL,
	ILLUSIONS,
	THIRSTOKINESIS,
	HAIR_MANIPULATION,
	ILLUMINATION,
	OMNIPOTENT,
	CLOAKING,
	CHANGING_ARMOR,
	POWER_COSMIC,
	BIOKINESIS,
	WATER_CONTROL,
	RADIATION_IMMUNITY,
	VISION_TELESCOPIC,
	TOXIN_AND_DISEASE_RESISTANCE,
	SPATIAL_AWARENESS,
	ENERGY_RESISTANCE,
	TELEPATHY_RESISTANCE,
	MOLECULAR_COMBUSTION,
	OMNILINGUALISM,
	PORTAL_CREATION,
	MAGNETISM,
	MIND_CONTROL_RESISTANCE,
	PLANT_CONTROL,
	SONAR,
	SONIC_SCREAM,
	TIME_MANIPULATION,
	ENHANCED_TOUCH,
	MAGIC_RESISTANCE,
	INVISIBILITY,
	SUB_MARINER,
	RADIATION_ABSORPTION,
	INTUITIVE_APTITUDE,
	VISION_MICROSCOPIC,
	MELTING,
	WIND_CONTROL,
	SUPER_BREATH,
	WALLCRAWLING,
	VISION_NIGHT,
	VISION_INFRARED,
	GRIM_REAPING,
	MATTER_ABSORPTION,
	THE_FORCE,
	RESURRECTION,
	TERRAKINESIS,
	VISION_HEAT,
	VITAKINESIS,
	RADAR_SENSE,
	QWARDIAN_POWER_RING,
	WEATHER_CONTROL,
	VISION_XRAY,
	VISION_THERMAL,
	WEB_CREATION,
	REALITY_WARPING,
	ODIN_FORCE,
	SYMBIOTE_COSTUME,
	SPEED_FORCE,
	PHOENIX_FORCE,
	MOLECULAR_DISSIPATION,
	VISION_CRYO,
	OMNIPRESENT,
	OMNISCIENT,
	RECORD_HASH,
	LOAD_DATE)
 as
 select 
 hb.being_id 
 , hb.hub_being_key 
 , sbst_bii.name 
 , sbst.* exclude (sat_being_superhero_set_key, hub_being_key)
 from data_vault.superhero.hub_being hb
 left join data_vault.superhero.sat_being_superhero_set sbst
     on hb.hub_being_key = sbst.hub_being_key
 left join data_vault.superhero.sat_being_superhero_set_bii sbst_bii
     on hb.hub_being_key = sbst_bii.hub_being_key
;

-- add pii tag to the view
use role data_classification;

alter table mart.superhero.super_beings
modify column name 
set tag raw.admin.bii_string='NAME';
