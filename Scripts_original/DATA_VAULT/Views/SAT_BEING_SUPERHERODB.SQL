CREATE OR REPLACE VIEW DATA_VAULT.SAT_BEING_SUPERHERODB
AS

WITH CTE_READ_FROM_RAW AS (
  SELECT
   SAT_BEING_SUPERHERODB_KEY
    , HUB_BEING_KEY
    , URL
    , SOURCE_URL
    , NAME
    , URL AS SOURCE_AS_IS_URL
    , INTELLIGENCE
    , STRENGTH
    , SPEED
    , DURABILITY
    , POWER
    , COMBAT
    , FULL_NAME
    , ALTER_EGOS
    , ALIASES
    , PLACE_OF_BIRTH
    , FIRST_APPEARANCE
    , CREATOR
    , ALIGNMENT
    , GENDER
    , RACE
    , HEIGHT
    , WEIGHT
    , EYE_COLOR
    , HAIR_COLOR
    , OCCUPATION
    , BASE
    , RELATIVES
    , SKIN_COLOR
    , TOTAL_POWER
    , RECORD_HASH
    , LOAD_TIME
    , LOAD_TIME as EFFECTIVE_FROM_DT
    , lead(LOAD_TIME) over (partition by HUB_BEING_KEY order by LOAD_TIME) as EFFECTIVE_TO_DT  
FROM DATA_VAULT.SAT_BEING_SUPERHERODB_RAW
)
SELECT 
      SAT_BEING_SUPERHERODB_KEY
    , HUB_BEING_KEY
    , URL
    , SOURCE_URL
    , NAME
    , URL AS SOURCE_AS_IS_URL
    , INTELLIGENCE
    , STRENGTH
    , SPEED
    , DURABILITY
    , POWER
    , COMBAT
    , FULL_NAME
    , ALTER_EGOS
    , ALIASES
    , PLACE_OF_BIRTH
    , FIRST_APPEARANCE
    , CREATOR
    , ALIGNMENT
    , GENDER
    , RACE
    , HEIGHT
    , WEIGHT
    , EYE_COLOR
    , HAIR_COLOR
    , OCCUPATION
    , BASE
    , RELATIVES
    , SKIN_COLOR
    , TOTAL_POWER
    , LOAD_TIME
    , EFFECTIVE_FROM_DT
    , ifnull(EFFECTIVE_TO_DT, '2099-12-31'::timestamp_tz)  as EFFECTIVE_TO_DT
    , (EFFECTIVE_TO_DT is null) as IS_CURRENT  
    , RECORD_HASH 
     FROM CTE_READ_FROM_RAW; 
